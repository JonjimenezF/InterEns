<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button (click)="goBack()" defaultHref="home" text=""></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content id="main-content">

  <!-- ðŸŒ¿ CABECERA DE FILTROS -->
  <section class="filter-section">
    <div class="logo-area">
      <ion-img src="assets/nuevos_img/interens-logo.png" alt="InterEns" class="logo"></ion-img>
    </div>

    <div class="search-and-filters">
      <!-- ðŸ” BUSCADOR -->
      <ion-searchbar
        placeholder="Buscar productos..."
        [(ngModel)]="searchQuery"
        class="searchbar"
        (ionInput)="applyAllFilters()">
      </ion-searchbar>

      <!-- ðŸŽšï¸ FILTROS -->
      <div class="filters-row">
        <p class="filter-label">Filtrar por:</p>

        <!-- CATEGORÃA -->
        <ion-item class="input-box">
          <ion-select
            interface="popover"
            placeholder="CategorÃ­a"
            [(ngModel)]="categoriaSeleccionada"
            (ionChange)="applyAllFilters()">
            <ion-select-option *ngFor="let cat of categorias" [value]="cat.id">
              {{ cat.nombre }}
            </ion-select-option>
          </ion-select>
        </ion-item>

        <!-- PUNTOS (min / max) -->
        <div class="price-row">
          <ion-item class="input-box">
            <ion-input
              type="number"
              placeholder="Puntos MÃ­n"
              [(ngModel)]="precioMin"
              [ngModelOptions]="{standalone: true}">
            </ion-input>
          </ion-item>

          <ion-item class="input-box">
            <ion-input
              type="number"
              placeholder="Puntos MÃ¡x"
              [(ngModel)]="precioMax"
              [ngModelOptions]="{standalone: true}">
            </ion-input>
          </ion-item>
        </div>

        <!-- BOTONES -->
        <div class="filter-buttons">
          <ion-button expand="block" class="apply-button" (click)="applyAllFilters()">
            Aplicar filtros
          </ion-button>

          <ion-button fill="clear" color="medium" (click)="resetFilters()">
            Limpiar filtros
          </ion-button>
        </div>
      </div>
    </div>
  </section>

  <!-- ðŸ”„ SPINNER DE CARGA -->
  <div *ngIf="loading" class="spinner-container">
    <ion-spinner class="custom-spinner" name="crescent"></ion-spinner>
    <p>Cargando productos...</p>
  </div>

  <!-- ðŸ›ï¸ LISTA DE PRODUCTOS -->
  <ion-grid *ngIf="!loading && filteredProducts.length > 0">
    <ion-row>
      <ion-col
        size="12"
        size-md="6"
        size-lg="4"
        *ngFor="let producto of filteredProducts">

        <ion-card class="product-card" (click)="goDetalleProducto(producto)">
          <img [src]="getImagenProducto(producto)" alt="Imagen del producto" class="product-image" />
          
          <div class="product-info">
            <h2>{{ producto.titulo }}</h2>
            <p class="desc">{{ producto.descripcion }}</p>
            <p class="price">
              <ion-icon name="trophy-outline"></ion-icon> {{ producto.valor_puntos }} pts
            </p>
            <p class="ubicacion">{{ producto.region }} - {{ producto.ciudad }}</p>
            
            <ion-button
              class="custom-button"
              (click)="agregarCarrito($event, producto)">
              Detalle Producto
            </ion-button>
          </div>
        </ion-card>

      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- ðŸª¶ SIN PRODUCTOS -->
  <div *ngIf="!loading && filteredProducts.length === 0" class="sin-productos">
    <ion-icon name="alert-circle-outline"></ion-icon>
    <p>No hay productos disponibles con estos filtros.</p>
  </div>

</ion-content>

<app-footer-interens></app-footer-interens>
