<ion-header>
  <ion-toolbar color="light">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="home"></ion-back-button>
    </ion-buttons>
    <ion-title>Subir Producto</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <form #productForm="ngForm">

    <!-- üîπ T√≠tulo -->
    <ion-item>
      <ion-label position="floating">T√≠tulo</ion-label>
      <ion-input type="text" [(ngModel)]="enser.titulo" name="titulo" required></ion-input>
    </ion-item>

    <!-- üîπ Descripci√≥n -->
    <ion-item>
      <ion-label position="floating">Descripci√≥n</ion-label>
      <ion-textarea rows="4" [(ngModel)]="enser.descripcion" name="descripcion" required></ion-textarea>
    </ion-item>

    <!-- üîπ Categor√≠a -->
    <ion-item>
      <ion-label>Categor√≠a</ion-label>
      <ion-select placeholder="Selecciona una" [(ngModel)]="enser.categoria_id" name="categoria_id" required>
        <ion-select-option *ngFor="let cat of categorias" [value]="cat.id">{{ cat.nombre }}</ion-select-option>
      </ion-select>
    </ion-item>

    <!-- üîπ Condici√≥n -->
    <ion-item class="custom-item green-border">
      <ion-label position="floating">Condici√≥n</ion-label>
      <ion-select
        placeholder="Selecciona una condici√≥n"
        [(ngModel)]="enser.condicion"
        name="condicion"
        required>
        <ion-select-option value="nuevo">Nuevo</ion-select-option>
        <ion-select-option value="como_nuevo">Como nuevo</ion-select-option>
        <ion-select-option value="bueno">Bueno</ion-select-option>
        <ion-select-option value="aceptable">Aceptable</ion-select-option>
        <ion-select-option value="para_reparar">Para reparar</ion-select-option>
      </ion-select>
    </ion-item>

    <!-- üîπ Valor en puntos -->
    <ion-item>
      <ion-label position="floating">Valor en puntos</ion-label>
      <ion-input type="number" [(ngModel)]="enser.valor_puntos" name="valor_puntos" required></ion-input>
    </ion-item>

    <!-- üîπ Ciudad -->
    <ion-item>
      <ion-label position="floating">Ciudad</ion-label>
      <ion-input type="text" [(ngModel)]="enser.ciudad" name="ciudad" required></ion-input>
    </ion-item>

    <!-- üîπ Regi√≥n -->
    <ion-item>
      <ion-label position="floating">Regi√≥n</ion-label>
      <ion-input type="text" [(ngModel)]="enser.region" name="region" required></ion-input>
    </ion-item>

    <!-- üîπ Im√°genes -->
    <ion-item>
      <ion-label>Seleccionar im√°genes</ion-label>
      <input type="file" (change)="onFilesSelected($event)" accept="image/*" multiple />
    </ion-item>

    <!-- üñºÔ∏è Vista previa -->
    <div *ngIf="previewUrls.length > 0" class="preview-container">
      <h4>Previsualizaci√≥n</h4>
      <div class="image-preview-grid">
        <div *ngFor="let url of previewUrls; let i = index" class="preview-wrapper">
          <img [src]="url" class="preview-img" />
          <button type="button" class="remove-btn" (click)="removeImage(i)">‚úñ</button>
        </div>
      </div>
    </div>

    <!-- üîò Botones de acci√≥n -->
    <div class="centrar">
      <ion-button expand="block" color="medium" shape="round" (click)="onSubmit(productForm, 'borrador')">
        Guardar Borrador
      </ion-button>

      <ion-button expand="block" color="primary" shape="round" (click)="onSubmit(productForm, 'publicado')">
        Publicar Producto
      </ion-button>
    </div>
  </form>

</ion-content>

<style>
  ion-content {
    --background: #1a1a1a;
    color: white;
  }

  h4 {
    color: #fff;
    text-align: center;
    margin-top: 1em;
  }

  .image-preview-grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    margin: 1em 0;
  }

  .preview-wrapper {
    position: relative;
    display: inline-block;
  }

  .preview-img {
    width: 90px;
    height: 90px;
    object-fit: cover;
    border-radius: 10px;
    border: 2px solid #6bc3ff;
  }

  .remove-btn {
    position: absolute;
    top: -5px;
    right: -5px;
    background-color: rgba(255, 0, 0, 0.8);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    width: 22px;
    height: 22px;
    font-size: 14px;
    line-height: 20px;
  }

  .centrar {
    text-align: center;
    margin-top: 1.5em;
  }
</style>
