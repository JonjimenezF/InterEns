<ion-header>
  <ion-toolbar color="light">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="home"></ion-back-button>
    </ion-buttons>
    <ion-title>Subir Producto</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <form (ngSubmit)="onSubmit(productForm)" #productForm="ngForm">

    <!-- üîπ T√≠tulo -->
    <ion-item>
      <ion-label position="floating">T√≠tulo</ion-label>
      <ion-input type="text" [(ngModel)]="enser.titulo" name="titulo" required></ion-input>
    </ion-item>

    <!-- üîπ Descripci√≥n -->
    <ion-item>
      <ion-label position="floating">Descripci√≥n</ion-label>
      <ion-textarea rows="4" [(ngModel)]="enser.descripcion" name="descripcion" required></ion-textarea>
    </ion-item>

    <!-- üîπ Categor√≠a -->
    <ion-item>
      <ion-label>Categor√≠a</ion-label>
      <ion-select placeholder="Selecciona una" [(ngModel)]="enser.categoria_id" name="categoria_id" required>
        <ion-select-option *ngFor="let cat of categorias" [value]="cat.id">{{ cat.nombre }}</ion-select-option>
      </ion-select>
    </ion-item>

    <!-- üîπ Condici√≥n -->
    <ion-item class="custom-item green-border">
      <ion-label position="floating">Condici√≥n</ion-label>
      <ion-select placeholder="Selecciona una condici√≥n" [(ngModel)]="enser.condicion" name="condicion" required>
        <ion-select-option value="nuevo">Nuevo</ion-select-option>
        <ion-select-option value="como_nuevo">Como nuevo</ion-select-option>
        <ion-select-option value="bueno">Bueno</ion-select-option>
        <ion-select-option value="aceptable">Aceptable</ion-select-option>
        <ion-select-option value="para_reparar">Para reparar</ion-select-option>
      </ion-select>
    </ion-item>

    <!-- üîπ Estado -->
    <ion-item class="custom-item green-border">
      <ion-label position="floating">Estado</ion-label>
      <ion-select placeholder="Selecciona un estado" [(ngModel)]="enser.estado" name="estado" required>
        <ion-select-option value="borrador">Borrador</ion-select-option>
        <ion-select-option value="publicado">Publicado</ion-select-option>
        <ion-select-option value="reservado">Reservado</ion-select-option>
        <ion-select-option value="intercambiado">Intercambiado</ion-select-option>
        <ion-select-option value="retirado">Retirado</ion-select-option>
        <ion-select-option value="bloqueado">Bloqueado</ion-select-option>
      </ion-select>
    </ion-item>

    <!-- üîπ Valor en puntos -->
    <ion-item>
      <ion-label position="floating">Valor en puntos</ion-label>
      <ion-input type="number" [(ngModel)]="enser.valor_puntos" name="valor_puntos" required></ion-input>
    </ion-item>

    <!-- üîπ Ciudad -->
    <ion-item>
      <ion-label position="floating">Ciudad</ion-label>
      <ion-input type="text" [(ngModel)]="enser.ciudad" name="ciudad" required></ion-input>
    </ion-item>

    <!-- üîπ Regi√≥n -->
    <ion-item>
      <ion-label position="floating">Regi√≥n</ion-label>
      <ion-input type="text" [(ngModel)]="enser.region" name="region" required></ion-input>
    </ion-item>

    <!-- üîπ Im√°genes -->
    <ion-item>
      <ion-label>Seleccionar im√°genes</ion-label>
      <input type="file" (change)="onFilesSelected($event)" accept="image/*" multiple />
    </ion-item>

    <!-- üñºÔ∏è Vista previa con opci√≥n de eliminar -->
    <div *ngIf="previewUrls.length > 0" class="preview-container">
      <h4>Previsualizaci√≥n</h4>
      <div class="image-preview-grid">
        <div *ngFor="let url of previewUrls; let i = index" class="image-wrapper">
          <img [src]="url" class="preview-img" />
          <button type="button" class="remove-btn" (click)="removeImage(i)">‚úï</button>
        </div>
      </div>
    </div>

    <!-- üîò Bot√≥n -->
    <div class="centrar">
      <ion-button expand="block" type="submit" color="primary" shape="round">
        Guardar Enser
      </ion-button>
    </div>
  </form>

</ion-content>

<style>
  ion-content {
    --background: #1a1a1a;
    color: white;
  }

  h4 {
    color: #fff;
    text-align: center;
    margin-top: 1em;
  }

  .image-preview-grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin: 1em 0;
  }

  .image-wrapper {
    position: relative;
    display: inline-block;
  }

  .preview-img {
    width: 90px;
    height: 90px;
    object-fit: cover;
    border-radius: 10px;
    border: 2px solid #6bc3ff;
  }

  .remove-btn {
    position: absolute;
    top: -5px;
    right: -5px;
    background: rgba(255, 0, 0, 0.8);
    color: white;
    border: none;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    cursor: pointer;
    font-size: 14px;
    line-height: 18px;
    transition: background 0.3s;
  }

  .remove-btn:hover {
    background: #ff4444;
  }

  .centrar {
    text-align: center;
    margin-top: 1.5em;
  }
</style>
